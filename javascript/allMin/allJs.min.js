function triNom(e,t){return e.nom<t.nom?-1:e.nom==t.nom?0:1}function triNomInv(e,t){return e.nom<t.nom?1:e.nom==t.nom?0:-1}function triQte(e,t){return e.qte<t.qte?-1:e.qte==t.qte?0:1}function triQteInv(e,t){return e.qte<t.qte?1:e.qte==t.qte?0:-1}function triPrix(e,t){return e.prix<t.prix?-1:e.prix==t.prix?0:1}function triPrixInv(e,t){return e.prix<t.prix?1:e.prix==t.prix?0:-1}function triCatego(e,t){return e.categorie<t.categorie?-1:e.categorie==t.categorie?0:1}function triCategoInv(e,t){return e.categorie<t.categorie?1:e.categorie==t.categorie?0:-1}function globalTri(e){document.getElementById("triNom").addEventListener("click",function(){e.sort(triNom),tbody.innerHTML="";for(var t=0;t<e.length;t++)containerAff.appendChild(creerTableau(e,t))},!1),document.getElementById("triNom2").addEventListener("click",function(){e.sort(triNom),tbody.innerHTML="";for(var t=0;t<e.length;t++)containerAff.appendChild(creerTableau(e,t))},!1),document.getElementById("triNomInv").addEventListener("click",function(){e.sort(triNomInv),tbody.innerHTML="";for(var t=0;t<e.length;t++)containerAff.appendChild(creerTableau(e,t))},!1),document.getElementById("triNomInv2").addEventListener("click",function(){e.sort(triNomInv),tbody.innerHTML="";for(var t=0;t<e.length;t++)containerAff.appendChild(creerTableau(e,t))},!1),document.getElementById("triQte").addEventListener("click",function(){e.sort(triQte),tbody.innerHTML="";for(var t=0;t<e.length;t++)containerAff.appendChild(creerTableau(e,t))},!1),document.getElementById("triQte2").addEventListener("click",function(){e.sort(triQte),tbody.innerHTML="";for(var t=0;t<e.length;t++)containerAff.appendChild(creerTableau(e,t))},!1),document.getElementById("triQteInv").addEventListener("click",function(){e.sort(triQteInv),tbody.innerHTML="";for(var t=0;t<e.length;t++)containerAff.appendChild(creerTableau(e,t))},!1),document.getElementById("triQteInv2").addEventListener("click",function(){e.sort(triQteInv),tbody.innerHTML="";for(var t=0;t<e.length;t++)containerAff.appendChild(creerTableau(e,t))},!1),document.getElementById("triPrix").addEventListener("click",function(){e.sort(triPrix),tbody.innerHTML="";for(var t=0;t<e.length;t++)containerAff.appendChild(creerTableau(e,t))},!1),document.getElementById("triPrix2").addEventListener("click",function(){e.sort(triPrix),tbody.innerHTML="";for(var t=0;t<e.length;t++)containerAff.appendChild(creerTableau(e,t))},!1),document.getElementById("triPrixInv").addEventListener("click",function(){e.sort(triPrixInv),tbody.innerHTML="";for(var t=0;t<e.length;t++)containerAff.appendChild(creerTableau(e,t))},!1),document.getElementById("triPrixInv2").addEventListener("click",function(t){e.sort(triPrixInv),tbody.innerHTML="";for(var n=0;n<e.length;n++)containerAff.appendChild(creerTableau(e,n))},!1),document.getElementById("triCatego").addEventListener("click",function(){e.sort(triCatego),tbody.innerHTML="";for(var t=0;t<e.length;t++)containerAff.appendChild(creerTableau(e,t))},!1),document.getElementById("triCatego2").addEventListener("click",function(){e.sort(triCatego),tbody.innerHTML="";for(var t=0;t<e.length;t++)containerAff.appendChild(creerTableau(e,t))},!1),document.getElementById("triCategoInv").addEventListener("click",function(){e.sort(triCategoInv),tbody.innerHTML="";for(var t=0;t<e.length;t++)containerAff.appendChild(creerTableau(e,t))},!1),document.getElementById("triCategoInv2").addEventListener("click",function(t){e.sort(triCategoInv),tbody.innerHTML="";for(var n=0;n<e.length;n++)containerAff.appendChild(creerTableau(e,n))},!1)}function creerTableau(e,t){var n=document.createElement("td");n.id="nom"+e[t]._id,n.textContent=e[t].nom;var a=document.createElement("td");a.id="qte"+e[t]._id,a.textContent=e[t].qte,a.style.textAlign="right";var i=document.createElement("td");i.id="prix"+e[t]._id,i.textContent=e[t].prix,i.style.textAlign="right";var r=document.createElement("td");r.id="catego"+e[t]._id,r.textContent=e[t].categorie,r.style.textAlign="right",""==r.textContent&&(r.textContent="Non répertorié",r.style.color="red");var l=document.createElement("td");l.id="check"+e[t]._id,l.textContent=e[t].check,l.style.textAlign="right";var o=document.createElement("td");o.id="qteRappel"+e[t]._id,o.textContent=e[t].qteRappel,o.style.textAlign="right";var d=document.createElement("button");d.textContent="",d.className="fa fa-pencil btnUpClass btnTab",d.name="Upbtn",d.id=e[t]._id,d.style.color="#00d8ff",d.style.width="50%";var c=document.createElement("button");c.textContent="",c.className="fa fa-trash btnTab",c.name="Supprbtn",c.id="suppr"+e[t]._id,c.style.color="#ff0000",c.style.width="50%";var s=document.createElement("button");s.className="fa fa-times btnTab",s.id="btn"+e[t]._id,s.style.display="none",s.style.color="#ff0000",s.style.width="50%";var u=document.createElement("button");u.className="fa fa-check btnTab",u.id="valid"+e[t]._id,u.style.display="none",u.style.color="#00ff00",u.style.width="50%";var m=document.createElement("td");m.style.textAlign="center",m.appendChild(d),m.appendChild(c),m.appendChild(u),m.appendChild(s);var p=document.createElement("tr");p.appendChild(n),p.appendChild(a),p.appendChild(i),p.appendChild(r),p.appendChild(l),p.appendChild(o),p.appendChild(m),tbody.appendChild(p),tableau.appendChild(tbody);var f=document.getElementById(e[t]._id),g=document.getElementById("btn"+e[t]._id),v=document.getElementById("valid"+e[t]._id),y=document.getElementById("suppr"+e[t]._id),C=document.getElementById("modifQte"),E=document.getElementById("cancelModifQte"),b=document.getElementById("validModifQte"),h=document.getElementById("nom"+e[t]._id),I=document.createElement("input");I.id="inputNom"+e[t]._id,I.type="text",I.className="inputText",I.value=e[t].nom,I.style.margin="0",I.style.color="#a50000";var x=document.getElementById("qte"+e[t]._id),B=document.createElement("input");B.type="number",B.className="inputText",B.id="allQteModif"+e[t]._id,B.value=e[t].qte,B.style.margin="0",B.style.color="#a50000",C.addEventListener("click",function(){E.style.display="inline",b.style.display="inline",C.style.display="none";for(var t=0;t<e.length;t++)x.innerHTML="",x.appendChild(B)},!1),b.addEventListener("click",function(){for(var t=0;t<e.length;t++)db.update({_id:e[t]._id},{$set:{qte:document.getElementById("allQteModif"+e[t]._id).value}},{multi:!0},function(e,t){});location.reload()},!1),E.addEventListener("click",function(){x.innerHTML=e[t].qte,E.style.display="none",b.style.display="none",C.style.display="inline"},!1);var L=document.getElementById("prix"+e[t]._id),k=document.createElement("input");k.type="number",k.className="inputText",k.step="0.01",k.value=e[t].prix,k.style.margin="0",k.style.color="#a50000";var T=document.getElementById("catego"+e[t]._id);T.style.textAlign="center";var N=document.createElement("select");N.style.margin="0",N.style.padding="15px",N.style.color="#a50000";var q=document.createElement("option");q.textContent=e[t].categorie,q.selected=!0,dbCategories.find({},function(e,t){for(var n=0;n<t.length;n++)N.appendChild(creerOptionCatego(t,n)),N.appendChild(q)});var _=document.getElementById("check"+e[t]._id);_.style.textAlign="center";var S=document.createElement("option");S.textContent="Oui";var A=document.createElement("option");A.textContent="Non";var M=document.createElement("select");M.style.margin="0",M.style.padding="15px",M.appendChild(S),M.appendChild(A),"Oui"==e[t].check?(S.selected=!0,A.selected=!1):(S.selected=!1,A.selected=!0),M.style.color="#a50000";var H=document.getElementById("qteRappel"+e[t]._id),w=document.createElement("input");return w.type="number",w.className="inputText",w.value=e[t].qteRappel,w.style.margin="0",w.style.color="#a50000",v.addEventListener("click",function(){B.value<0?B.value=0:""==B.value&&(B.value=0),k.value<0?k.value=0:""==k.value&&(k.value=0),w.value<0&&(w.value=0);var n=N.selectedIndex,a=T.getElementsByTagName("option")[n].value;db.update({_id:e[t]._id},{$set:{nom:I.value,qte:B.value,prix:k.value,categorie:a,qteRappel:w.value,check:M.value}},{multi:!0},function(e,t){}),s.style.display="none",u.style.display="none",d.style.display="inline",location.reload()},!1),y.addEventListener("click",function(){var n=confirm("Voulez vous vraiment supprimer le produit "+e[t].nom+" ?","Gestion de courses");n&&(db.remove({_id:e[t]._id},{},function(e,t){}),location.reload())},!1),d.addEventListener("click",function(){for(var t=0;t<e.length;t++)document.getElementsByName("Upbtn")[t].disabled=!0,document.getElementsByName("Upbtn")[t].style.color="#aaaaaa",document.getElementsByName("Supprbtn")[t].disabled=!0,document.getElementsByName("Supprbtn")[t].style.color="#aaaaaa"},!1),s.addEventListener("click",function(){for(var t=0;t<e.length;t++)document.getElementsByName("Upbtn")[t].disabled=!1,document.getElementsByName("Upbtn")[t].style.color="#00d8ff",document.getElementsByName("Supprbtn")[t].disabled=!1,document.getElementsByName("Supprbtn")[t].style.color="#ff0000"},!1),f.addEventListener("click",function(){s.style.display="inline",u.style.display="inline",d.style.display="none",c.style.display="none",h.innerHTML="",h.appendChild(I),x.innerHTML="",x.appendChild(B),L.innerHTML="",L.appendChild(k),T.innerHTML="",T.appendChild(N),_.innerHTML="",_.appendChild(M),H.innerHTML="",H.appendChild(w),g.addEventListener("click",function(){h.innerHTML=e[t].nom,x.innerHTML=e[t].qte,L.innerHTML=e[t].prix,T.innerHTML=e[t].categorie,_.innerHTML=e[t].check,H.innerHTML=e[t].qteRappel,s.style.display="none",u.style.display="none",d.style.display="inline",c.style.display="inline"},!1)},!1),tableau}function creerOptionCatego(e,t){e.sort(triNom);var n=document.createElement("option");return n.textContent=e[t].nom,n}function creerListe(e,t){var n=document.createElement("td");n.textContent=e[t].nom,n.id="listeNom"+e[t]._id;var a=document.createElement("td");a.id="celluleQteAchat";var i=document.createElement("button");i.textContent="",i.className="btnListe fa fa-plus";var r=document.createElement("label");r.textContent=" "+e[t].qteAchat+" ";var l=document.createElement("button");l.className="btnListe fa fa-minus",l.textContent="",a.appendChild(l),a.appendChild(r),a.appendChild(i);var o=parseInt(e[t].qteAchat);i.addEventListener("click",function(){db.update({_id:e[t]._id},{$set:{qteAchat:(o+=1).toString()}},{multi:!0},function(e,t){}),location.reload()},!1),l.addEventListener("click",function(){db.update({_id:e[t]._id},{$set:{qteAchat:(o-=1).toString()}},{multi:!0},function(e,t){}),location.reload()},!1);var d=document.createElement("td");d.textContent=(e[t].prix*e[t].qteAchat).toFixed(2)+" €",d.style.textAlign="right",d.style.paddingRight="10px",d.style.width="200px";var c=document.createElement("td");c.id="celluleCoche";var s=document.createElement("input"),u=document.createElement("label");s.type="checkbox",s.name="listeCheck",s.id="listeCheck"+e[t]._id,s.className="check",u.className="labCheck",u.htmlFor="listeCheck"+e[t]._id,c.appendChild(s),c.appendChild(u),s.addEventListener("click",function(){document.getElementById("listeCheck"+e[t]._id).checked?(document.getElementById("listeNom"+e[t]._id).style.color="red",document.getElementById("listeNom"+e[t]._id).style.textDecoration="line-through",l.style.color="#aaaaaa",i.style.color="#aaaaaa",l.disabled=!0,i.disabled=!0):(document.getElementById("listeNom"+e[t]._id).style.color="#ccc",document.getElementById("listeNom"+e[t]._id).style.textDecoration="none",l.style.color="black",i.style.color="black",l.disabled=!1,i.disabled=!1)},!1),formListe.addEventListener("submit",function(n){n.preventDefault(),document.getElementById("listeCheck"+e[t]._id).checked&&(console.log(e[t].nom),db.update({_id:e[t]._id},{$set:{qte:(parseFloat(e[t].qte)+parseFloat(e[t].qteAchat)).toString(),qteAchat:"1"}},{multi:!0},function(e,t){}),location.reload())});var m=document.createElement("tr");return m.appendChild(n),m.appendChild(a),m.appendChild(d),m.appendChild(c),ligneTotal=document.createElement("tr"),listeDeCourse.appendChild(m),listeDeCourse}function creerListeCategories(e,t){var n=document.createElement("li");return n.textContent="- "+e[t].nom,n.id="catego"+e[t]._id,n}function openTab(e,t){var n,a,i;for(a=document.getElementsByClassName("tabcontent"),n=0;n<a.length;n++)a[n].style.display="none";for(i=document.getElementsByClassName("tablinks"),n=0;n<i.length;n++)i[n].className=i[n].className.replace(" active","");document.getElementById(t).style.display="block",e.currentTarget.className+=" active"}var Datastore=require("nedb"),db=new Datastore({filename:"db/produits.json",autoload:!0}),Datastore=require("nedb"),dbCategories=new Datastore({filename:"db/categories.json",autoload:!0}),tbody=document.getElementById("tbody"),tableau=document.getElementById("tableau"),containerAff=document.getElementById("containerAff");db.find({},function(e,t){t.sort(triNom),globalTri(t);for(var n=0;n<t.length;n++){containerAff.appendChild(creerTableau(t,n));var a=document.getElementById("qteRappel"+t[n]._id);"Non"==t[n].check&&(a.innerHTML="",a.style.background="repeating-linear-gradient(45deg, #242424, #242424 5px, #555555 5px, #555555 10px)"),0==t[n].prix&&(document.getElementById("prix"+t[n]._id).style.color="red"),"Non répertorié"==t[n].categorie&&(document.getElementById("catego"+t[n]._id).style.color="red")}});var formAjSuppr=document.getElementById("formAjSuppr"),prod=document.getElementById("prod"),qte=document.getElementById("qte"),prix=document.getElementById("prix"),check=document.getElementById("check"),qteRappel=document.getElementById("qteRappel");qteRappel.style.display="none";var selectCatego=document.getElementById("selectCatego");dbCategories.find({},function(e,t){for(var n=0;n<t.length;n++)selectCatego.appendChild(creerOptionCatego(t,n))}),check.addEventListener("click",function(){1==check.checked?qteRappel.style.display="inline":qteRappel.style.display="none"},function(e,t){},!1);var affCheck;formAjSuppr.addEventListener("submit",function(e){qte.value<0?qte.value=0:""==qte.value&&(qte.value=0),prix.value<0?prix.value=0:""==prix.value&&(prix.value=0),qteRappel.value<0?qteRappel.value=0:""==qteRappel.value&&(qteRappel.value=0),affCheck=1==check.checked?"Oui":"Non";var t=0;db.find({},function(e,n){for(var a=0;a<n.length;a++)n[a].nom.toLowerCase()==prod.value.toLowerCase()&&t++;if(0==t){var i=selectCatego.selectedIndex,r=document.getElementsByTagName("option")[i].value;db.insert({nom:prod.value,qte:qte.value,prix:prix.value,categorie:r,check:affCheck,qteRappel:qteRappel.value,qteAchat:"1"})}else document.getElementById("aide").textContent="Attention : "+prod.value+" existe déja.",prod.value=""})});var listeDeCourse=document.getElementById("listeDeCourse"),thTotal=document.getElementById("total"),total=0,formListe=document.getElementById("formListe"),btnSubListe=document.getElementById("btnSubListe"),containerListeDeCourse=document.getElementById("containerListeDeCourse");db.find({},function(e,t){t.sort(triCatego);for(var n=0;n<t.length;n++){var i=t[n].qte<=t[n].qteRappel;if(1==i){containerListeDeCourse.appendChild(creerListe(t,n));var r=parseFloat(t[n].prix*t[n].qteAchat);total+=r}}thTotal.textContent=total.toFixed(2)+" €",thTotal.style.textAlign="right"});var listeCategories=document.getElementById("listeCategories"),formSupprCatego=document.getElementById("formSupprCategorie");dbCategories.find({},function(e,t){for(var n=!1,a=0;a<t.length;a++)"Non répertorié"==t[a].nom&&(n=!0);0==a?(dbCategories.insert({nom:"Non répertorié"}),location.reload()):n||(dbCategories.insert({nom:"Non répertorié"}),location.reload())}),dbCategories.find({},function(e,t){for(var n=0;n<t.length;n++)listeCategories.appendChild(creerListeCategories(t,n))});var formCatergorie=document.getElementById("formCategorie"),valueInput=document.getElementById("categorie");formCategorie.addEventListener("submit",function(e){e.preventDefault();var t=0;dbCategories.find({},function(e,n){for(var a=0;a<n.length;a++)n[a].nom.toLowerCase()==valueInput.value.toLowerCase()&&t++;0==t?(dbCategories.insert({nom:valueInput.value}),location.reload()):(document.getElementById("aideCategorie").textContent="Attention : "+valueInput.value+" existe déja.",valueInput.value="")})});var selectCategoSuppr=document.getElementById("selectCategoSuppr");dbCategories.find({},function(e,t){for(var n=0;n<t.length;n++)selectCategoSuppr.appendChild(creerOptionCatego(t,n));formSupprCatego.addEventListener("submit",function(e){e.preventDefault();var t=selectCategoSuppr.selectedIndex,n=formSupprCategorie.getElementsByTagName("option")[t].value,a=confirm('Voulez vous vraiment supprimer la catégorie " '+n+' " ?',"Gestion de courses");a&&(dbCategories.remove({nom:n},{},function(e,t){}),db.update({categorie:n},{$set:{categorie:""}},{multi:!0},function(e,t){}),location.reload())},!1);var a=document.getElementById("btnModifCatego"),i=document.getElementById("subSupprCatego"),r=document.getElementById("btnValidModifCatego"),l=document.getElementById("inputModifCatego"),o=document.getElementById("btnAnnuleModifCatego");l.style.display="none",r.style.display="none",o.style.display="none",a.addEventListener("click",function(){var e=selectCategoSuppr.selectedIndex,t=formSupprCategorie.getElementsByTagName("option")[e].value;i.style.display="none",selectCategoSuppr.disabled=!0,selectCategoSuppr.style.backgroundColor="gray",selectCategoSuppr.style.color="#484848",l.style.display="inline",r.style.display="inline",o.style.display="inline",a.style.display="none",l.value=t,o.addEventListener("click",function(){selectCategoSuppr.style.backgroundColor="none",selectCategoSuppr.style.background="#d9dded",selectCategoSuppr.style.color="#1d1d1d",i.style.display="inline",l.style.display="none",r.style.display="none",o.style.display="none",a.style.display="inline",selectCategoSuppr.disabled=!1},!1),r.addEventListener("click",function(){dbCategories.update({nom:t},{$set:{nom:l.value}},{multi:!0},function(e,t){}),location.reload()},!1)},!1)}),document.getElementById("defaultOpen").click();const remote=require("electron").remote,current_window=remote.getCurrentWindow();document.getElementById("close").addEventListener("click",function(e){current_window.close()}),document.getElementById("minimize").addEventListener("click",function(e){current_window.minimize()}),document.getElementById("maximize").addEventListener("click",function(e){current_window.maximize()}),document.getElementById("unmaximize").addEventListener("click",function(e){current_window.unmaximize()});
const ipc = require('electron').ipcRenderer
const printPdf = document.getElementById('printPdf')
printPdf.addEventListener('click', function (event) {
	ipc.send('print-to-pdf')
})
ipc.on('wrote-pdf', function (event, path) {
	const message = `Enregistrement du PDF ici : ${path}`
	document.getElementById('msgPdf').innerHTML = message
})
